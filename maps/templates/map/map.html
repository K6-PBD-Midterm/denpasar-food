{% extends 'base.html' %}
{% load static %}
{% block map_meta %}
<link rel="stylesheet" href="{% static 'map/css/styles.css' %}"/>
{% endblock %}
{% block content %}

    <div id="search-container" class="sticky top-24 left-0 right-0 z-50 w-full p-4 transition-all duration-300 bg-[#f9f9f9]">
        <form id="search-form" method="get" action="{% url 'map' %}" class="flex justify-center items-center max-w-screen-md mx-auto">
            <div class="relative w-full h-full">
                <input type="text" name="search" placeholder="Search..." value="{{ request.GET.search }}" class="bg-white border border-gray-300 text-black placeholder-gray-500 text-sm rounded-l-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 font-sans">
            </div>
            <button type="submit" class="bg-[#005f75] text-white p-2.5 rounded-r-lg font-sans">Search</button>
        </form>
    </div>
    {% if restaurants %}
    <div id="map_container">
        <div id="map"></div>
    </div>
    {% else %}
    <div id="map_container">
        <div id="map"></div>
        <script>
            var map = L.map('map').setView([-8.670458, 115.212629], 13); // Coordinates for Denpasar, Bali

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            L.popup()
                .setLatLng([-8.670458, 115.212629])
                .setContent('No restaurants found')
                .openOn(map);
        </script>
    {% endif %}
    <script>

        var map = L.map('map').setView([-8.670458, 115.212629], 13); // Coordinates for Denpasar, Bali

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        const restaurantsData = {{ restaurants|safe }};
        restaurantsData.forEach(restaurant => {
        const marker = L.marker([restaurant.latitude, restaurant.longitude]).addTo(map);
        marker.bindPopup(`
             <div style="display: flex; align-items: center;">
                <img src="${restaurant.image_url}" alt="${restaurant.name}" style="width: 50px; height: 50px; object-fit: cover; margin-right: 10px;">
                <div>
                    <b>${restaurant.name}</b><br>
                    <ul>${restaurant.cuisines.map(cuisine => `<li>${cuisine}</li>`).join('')}</ul>
                    Notation : ${restaurant.rating}<br>
                    Price : ${restaurant.price_range}
                </div>
            </div>
                `);
        });

     
    </script>
{% endblock %}